<!doctype html>
<html lang="pt-br">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Gerador Mega da Virada (PyScript)</title>

  <!-- PyScript -->
  <link rel="stylesheet" href="https://pyscript.net/releases/2024.1.1/core.css">
  <script type="module" src="https://pyscript.net/releases/2024.1.1/core.js"></script>

  <style>
    body { font-family: system-ui, Arial, sans-serif; max-width: 900px; margin: 24px auto; padding: 0 16px; }
    h1 { font-size: 1.25rem; margin-bottom: 0.5rem; }
    .card { border: 1px solid #ddd; border-radius: 12px; padding: 16px; }
    .row { display: flex; gap: 12px; flex-wrap: wrap; align-items: end; }
    label { display: block; font-weight: 600; margin-bottom: 6px; }
    input[type="number"] { padding: 10px; border-radius: 10px; border: 1px solid #ccc; min-width: 160px; }
    select { padding:10px;border-radius:10px;border:1px solid #ccc;min-width:220px; }
    button { padding: 10px 14px; border: 1px solid #333; border-radius: 10px; background: #111; color: #fff; cursor: pointer; }
    button.secondary { background: #fff; color: #111; }
    pre { background: #0b1020; color: #e7e7e7; padding: 14px; border-radius: 12px; overflow: auto; }
    .muted { color: #555; font-size: 0.95rem; line-height: 1.35; }
    .error { color: #b00020; font-weight: 600; }
  </style>
</head>

<body>
  <h1>Gerador Mega da Virada (baseado em aproximação / gaps)</h1>

  <div class="card">
    <div class="row">
      <div>
        <label>Quantidade de jogos</label>
        <input id="qtd" type="number" min="1" max="500" value="10" />
      </div>

      <div>
        <label>Variação dos gaps (sd_gap)</label>
        <input id="sd" type="number" min="0.5" max="10" step="0.5" value="3.0" />
      </div>

      <div>
        <label>Excluir sequências históricas</label>
        <select id="excluir">
          <option value="true" selected>Sim</option>
          <option value="false">Não</option>
        </select>
      </div>

      <button id="btn_gerar">Gerar</button>
      <button class="secondary" id="btn_limpar">Limpar</button>
      <button class="secondary" id="btn_copiar">Copiar</button>
    </div>

    <p id="msg" class="error" style="margin-top:12px;"></p>
    <pre id="saida" style="margin-top:12px;">(os jogos vão aparecer aqui)</pre>
  </div>

  <py-script>
import random
from typing import List, Set, Tuple
from pyscript import document
import js
from pyodide.ffi import create_proxy

# ----------------------------
# Dados
# ----------------------------

numeros_excluidos = {7, 8, 26, 28, 39, 44, 54, 60}
numeros_validos = [n for n in range(1, 61) if n not in numeros_excluidos]
validos_set = set(numeros_validos)

GAP_MEANS = [11.8235, 10.6471, 7.2353, 9.0588, 9.2941]

SEQUENCIAS_HISTORICAS: Set[Tuple[int, int, int, int, int, int]] = {
    (10, 27, 40, 46, 49, 58), # 2009
    (2, 10, 34, 37, 43, 50), # 2010
    (3, 4, 29, 36, 45, 55), # 2011
    (14, 32, 33, 36, 41, 52), # 2012
    (20, 30, 36, 38, 47, 53), # 2013
    (1, 5, 11, 16, 20, 56), # 2014
    (2, 18, 31, 42, 51, 56), # 2015
    (5, 11, 22, 24, 51, 53), # 2016
    (3, 6, 10, 17, 34, 37), # 2017
    (5, 10, 12, 18, 25, 33), # 2018
    (3, 35, 38, 40, 57, 58), # 2019
    (17, 20, 22, 35, 41, 42), # 2020
    (12, 15, 23, 32, 33, 46), # 2021
    (4, 5, 10, 34, 58, 59), # 2022
    (21, 24, 33, 41, 48, 56), # 2023
    (1, 17, 19, 29, 50, 57), # 2024
    (9, 13, 21, 32, 33, 59), # 2025
}

# ----------------------------
# Lógica
# ----------------------------

def _sample_gap(mean, sd):
    g = int(round(random.gauss(mean, sd)))
    return max(1, min(30, g))

def gerar_jogo(sd_gap, excluir_hist):
    while True:
        gaps = [_sample_gap(m, sd_gap) for m in GAP_MEANS]
        span = sum(gaps)
        if span >= 60:
            continue

        a1 = random.randint(1, 60 - span)
        jogo = [a1]
        for g in gaps:
            jogo.append(jogo[-1] + g)

        if any(n not in validos_set for n in jogo):
            continue
        if excluir_hist and tuple(jogo) in SEQUENCIAS_HISTORICAS:
            continue

        return jogo

# ----------------------------
# UI
# ----------------------------

def on_limpar(evt):
    document.getElementById("msg").textContent = ""
    document.getElementById("saida").textContent = "(os jogos vão aparecer aqui)"

def on_copiar(evt):
    txt = document.getElementById("saida").textContent
    if "(" in txt:
        return
    js.navigator.clipboard.writeText(txt)

def on_gerar(evt):
    document.getElementById("msg").textContent = ""

    try:
        qtd = int(document.getElementById("qtd").value)
        sd_gap = float(document.getElementById("sd").value)
        excluir = document.getElementById("excluir").value == "true"
    except:
        document.getElementById("msg").textContent = "Valores inválidos."
        return

    jogos = set()
    linhas = []

    for i in range(qtd):
        jogo = gerar_jogo(sd_gap, excluir)
        jogos.add(tuple(jogo))
        linhas.append(f"Jogo {i+1:03d}: " + " – ".join(f"{n:02d}" for n in jogo))

    document.getElementById("saida").textContent = "\n".join(linhas)

# ----------------------------
# Proxies (CORREÇÃO DO ERRO)
# ----------------------------

document.getElementById("btn_gerar").addEventListener(
    "click", create_proxy(on_gerar)
)
document.getElementById("btn_limpar").addEventListener(
    "click", create_proxy(on_limpar)
)
document.getElementById("btn_copiar").addEventListener(
    "click", create_proxy(on_copiar)
)
  </py-script>
</body>
</html>
